---
layout: post
title: Data Transfer - How Much Is Too Much?
---

So here's the challenge:

## The Challenge!
Let's say you have a public facing service that you can't restrict based on source IP, geo-location, or time. It could be your client's Citrix portal, web VPN, OWA, or some other sort of portal that needs to be exposed to the world in order for your users to be able to log in from anywhere, at any time.

## That's okay, I have a NextGen firewall!
Yes, in an ideal world, your super awesome, deep-packet-inspecting, ssl-decrypting, malware-scanning, application-detecting, omniscient, omnipotent, almighty NextGen firewall would whack the bad guy right in the head and shun them for a whole 30 minutes, but let's face it, things don't just quite work the way your firewall sales person explained it to you now, do they? Licenses expire, certificates expire, IP blacklists get out of sync, some other admin creates an allow:any/any rule, and how on earth would your fancy firewall know John Doe logging in to OWA from North Carolina with a legitimate password is actually cyber criminal in Nigeria pivoting from an already-compromised machine?  

## But I have MFA!
Let's say you're a good engineer and have enforced MFA so that the login page won't let the threat actors waltz right in using a password they've found on the dark web, or stolen using a phishing attack, but you have this nagging feeling in the back of your head that some junior admin somewhere might have disabled it for a few too-busy-to-unlock-their-phone users, or your users have become numb to endless MFA notifications, they say 'yes' to anything, letting anyone walk right in. No kidding, I had one user telling me he thought he must have left a browser tab open somewhere, so he just tapped on 'yes' to get this annoying pop-up to disappear. Yeah, yeah, humans are the weakest link, they're so gullible, blah blah blah, but seriuosly, with hundreds of MFA pop-ups per week, can we really blame the user? But that's a topic for another blog post.

## But, but, what about my SIEM?
Let's say you're so good that you have accounted for the scenario above, and integrated your firewall or router with a SIEM solution, ingesting logs for every single TCP session in any direction, enriching them with GeoIP and known-bad IP blacklist matching, so you can get an alert every time bad guys even dares so much to look at your login portal the wrong way. But now you're getting hundreds of alerts per day generated by page loads, port scans, and other sorts of recon activity. The alerts are almost useless.

So all you're left with is a gazillion lousy netflow or firewall alerts saying that Sauron, which we all know is evil, from Mordor, which is notorious for evil activity, has made a successfull inbound connection to your cute web VPN login page with company logo gracefully rising through the horizon over a calm ocean background, and transferred a whopping 1.2MB of data over port 443. Okay. Well. 1.2MB isn't a big deal, right? Or is it? 

## Data

1. Traffic to/from a known bad IP address
2. Traffic was allowed by firewall (total bytes > 0)
3. X bytes were transferred



| Application      | Google Query | Avg. Bytes | Max. Bytes | 
| ----------- | ----------- | ------------- | -------- |
| Citrix Logon Page Load      | "Citrix Receiver" inurl:index.html "Gateway" |  1.36 MB | 1.6 MB |


